<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skill Tree Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Poppins:wght@400;600&family=Exo+2:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0a141f, #142b41, #1e4060);
      color: #e0f7fa;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .glass {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.15);
      -webkit-backdrop-filter: blur(15px); /* Safari 9+ */
      backdrop-filter: blur(15px);
      border-radius: 1rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .glass:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 255, 204, 0.2);
    }
    header { position: fixed; top: 0; left: 0; width: 100%; z-index: 100; }
    .sidebar {
      position: fixed; top: 4rem; left: 0; width: 18rem; height: calc(100vh - 4rem);
      background: rgba(255, 255, 255, 0.05); border-right: 2px solid rgba(0, 255, 204, 0.3);
      transform: translateX(-100%); transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 1.5rem; z-index: 50;
    }
    .sidebar.open { transform: translateX(0); }
    .main-content { display: flex; padding-top: 4rem; min-height: calc(100vh - 4rem); width: 100%; transition: padding-left 0.5s ease; gap: 0.5rem; }
    .main-content.shifted { padding-left: 18rem; }
    .knowledge-tree-section { flex: 2; display: flex; justify-content: center; padding: 1rem; opacity: 0; animation: fadeIn 1s ease-in forwards; }
    .task-section-container { flex: 1; display: flex; flex-direction: column; gap: 1rem; padding: 1rem; align-items: center; opacity: 0; animation: fadeIn 1s ease-in forwards; animation-delay: 0.3s; }
    .progress-ring { position: relative; width: 50px; height: 50px; }
    .progress-ring canvas { position: absolute; top: 0; left: 0; }
    .progress-ring span { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; }
    #profileDropdown { opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
    #profileDropdown.dropdown-visible { opacity: 1; pointer-events: auto; }
    .particle { position: absolute; background: rgba(0, 255, 204, 0.2); border-radius: 50%; animation: float 10s infinite ease-in-out; pointer-events: none; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    @keyframes fadeIn { to { opacity: 1; } }
    @media (max-width: 768px) {
      .main-content { flex-direction: column; padding-left: 0; gap: 1rem; }
      .main-content.shifted { padding-left: 0; }
      .knowledge-tree-section, .task-section-container { width: 100%; padding: 1rem; }
      .sidebar { width: 100%; height: auto; }
    }
  </style>
</head>
<body>
  <header class="h-16 bg-gray-900 bg-opacity-90 shadow-lg flex items-center justify-between px-6">
    <div class="flex items-center space-x-2 cursor-pointer" id="toggleSidebar">
      <span class="text-2xl font-bold text-teal-400 font-exo">SkillTree</span>
      <i data-lucide="tree" class="w-6 h-6 text-teal-300"></i>
    </div>
    <input type="text" placeholder="Search skills..." class="px-4 py-2 rounded-full bg-gray-800 text-gray-200 w-64 focus:outline-none focus:ring-2 focus:ring-teal-300" id="searchInput">
    <div class="flex items-center space-x-4">
      <i data-lucide="bell" class="w-6 h-6 text-gray-300 hover:text-teal-300 cursor-pointer"></i>
      <i data-lucide="message-circle" class="w-6 h-6 text-gray-300 hover:text-teal-300 cursor-pointer"></i>
      <div class="relative">
        <div class="w-10 h-10 flex items-center justify-center bg-gradient-to-br from-teal-500 to-teal-700 text-white rounded-full cursor-pointer" id="profileToggle">T</div>
        <div id="profileDropdown" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg">
          <a href="#" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">Settings</a>
          <a href="#" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700" id="logoutLink">Logout</a>
        </div>
      </div>
    </div>
  </header>

  <aside class="sidebar">
    <nav class="space-y-2">
      <a href="#" class="flex items-center space-x-2 p-2 rounded-lg bg-teal-700 text-white" id="dashboardToggle">
        <i data-lucide="home" class="w-5 h-5"></i>
        <span class="text-sm">Dashboard</span>
      </a>
      <a href="#" class="flex items-center space-x-2 p-2 rounded-lg text-gray-300 hover:bg-gray-700">
        <i data-lucide="compass" class="w-5 h-5"></i>
        <span class="text-sm">Explore</span>
      </a>
      <a href="#" class="flex items-center space-x-2 p-2 rounded-lg text-gray-300 hover:bg-gray-700">
        <i data-lucide="list" class="w-5 h-5"></i>
        <span class="text-sm">Last Tasks</span>
      </a>
      <a href="#" class="flex items-center space-x-2 p-2 rounded-lg text-gray-300 hover:bg-gray-700" id="sidebarSettings">
        <i data-lucide="settings" class="w-5 h-5"></i>
        <span class="text-sm">Settings</span>
      </a>
    </nav>
  </aside>

  <div class="main-content" id="mainContent">
    <section class="knowledge-tree-section">
      <div class="glass p-6 rounded-xl shadow-lg flex flex-col items-center text-center w-full max-w-3xl">
        <h2 class="text-3xl mb-4 font-bold text-teal-200 font-exo">Your Knowledge Tree</h2>
        <div id="treeCanvas" class="w-full h-80 relative overflow-hidden mb-2">
          <svg id="treeSvg" width="100%" height="100%" viewBox="0 0 120 120" preserveAspectRatio="xMidYMid meet">
            <path d="M60,110 L60,60" stroke="#00cc99" stroke-width="3" fill="none"/>
            <path d="M60,60 L45,45" stroke="#00cc99" stroke-width="2" fill="none"/>
            <path d="M60,60 L75,45" stroke="#00cc99" stroke-width="2" fill="none"/>
            <ellipse cx="45" cy="45" rx="4" ry="3" fill="#00ffcc"/>
            <ellipse cx="75" cy="45" rx="4" ry="3" fill="#00ffcc"/>
          </svg>
        </div>
        <div class="text-lg text-gray-300 font-semibold mb-2" id="welcomeText">Welcome back, Guest — Today’s goal: Master loops!</div>
        <button class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-400 transition-colors text-sm" id="plantSkill">Plant New Skill</button>
      </div>
    </section>

    <section class="task-section-container">
      <div class="glass p-4 rounded-xl shadow-lg w-64 h-64">
        <h3 class="text-lg font-bold text-teal-200 mb-2 text-center">Task</h3>
        <canvas id="taskChart" class="w-full h-48"></canvas>
      </div>
      <div class="glass p-4 rounded-xl shadow-lg w-64 h-32">
        <h3 class="text-lg font-bold text-teal-200 mb-2 text-center">Progress per Month</h3>
        <div class="flex justify-around">
          <div class="progress-ring"><canvas id="progressCanvas1" width="50" height="50"></canvas><span class="text-sm text-teal-200" id="progressText1">0%</span></div>
          <div class="progress-ring"><canvas id="progressCanvas2" width="50" height="50"></canvas><span class="text-sm text-teal-200" id="progressText2">0%</span></div>
          <div class="progress-ring"><canvas id="progressCanvas3" width="50" height="50"></canvas><span class="text-sm text-teal-200" id="progressText3">0%</span></div>
        </div>
      </div>
      <div class="glass p-4 rounded-xl shadow-lg w-64 h-32">
        <h3 class="text-lg font-bold text-teal-200 mb-2 text-center">Achievements</h3>
        <div class="flex justify-center gap-4">
          <i data-lucide="award" class="w-6 h-6 text-teal-200"></i>
          <i data-lucide="star" class="w-6 h-6 text-teal-200"></i>
          <i data-lucide="trophy" class="w-6 h-6 text-teal-200"></i>
        </div>
        <div class="mt-2 text-sm text-gray-200 text-center"><p>0 per month</p></div>
      </div>
    </section>
  </div>

  <script>
    const themeColors = { primary: '#00ffcc', dark: '#1e4060', text: '#e0f7fa' };
    const config = { ringRadius: 18, ringWidth: 4 };

    class ProgressRing {
      constructor(canvas, percentage, textElement) {
        this.canvas = canvas; this.percentage = percentage; this.textElement = textElement;
        this.ctx = canvas.getContext('2d'); this.draw();
      }
      draw() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        const cx = this.canvas.width / 2, cy = this.canvas.height / 2;
        const start = -0.5 * Math.PI, end = start + (this.percentage / 100) * 2 * Math.PI;
        this.ctx.beginPath(); this.ctx.arc(cx, cy, config.ringRadius, 0, 2 * Math.PI);
        this.ctx.lineWidth = config.ringWidth; this.ctx.strokeStyle = themeColors.dark; this.ctx.stroke();
        this.ctx.beginPath(); this.ctx.arc(cx, cy, config.ringRadius, start, end);
        this.ctx.strokeStyle = themeColors.primary; this.ctx.stroke();
        this.textElement.textContent = `${this.percentage}%`;
      }
    }

    function createParticles() {
      for (let i = 0; i < 20; i++) {
        const p = document.createElement('div'); p.classList.add('particle');
        p.style.width = p.style.height = `${Math.random() * 5 + 2}px`;
        p.style.left = `${Math.random() * 100}vw`; p.style.top = `${Math.random() * 100}vh`;
        p.style.animationDelay = `${Math.random() * 5}s`; document.body.appendChild(p);
      }
    }

    function initProgressRings() {
      new ProgressRing(document.getElementById('progressCanvas1'), 0, document.getElementById('progressText1'));
      new ProgressRing(document.getElementById('progressCanvas2'), 0, document.getElementById('progressText2'));
      new ProgressRing(document.getElementById('progressCanvas3'), 0, document.getElementById('progressText3'));
    }

    function initTaskChart() {
      new Chart(document.getElementById('taskChart'), {
        type: 'line', data: { labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'], datasets: [{ label: 'Tasks', data: [5, 10, 15, 20, 25], borderColor: themeColors.primary, fill: false }] },
        options: { responsive: true, maintainAspectRatio: false, scales: { x: { ticks: { color: themeColors.text } }, y: { ticks: { color: themeColors.text } } }, plugins: { legend: { labels: { color: themeColors.text } } } }
      });
    }

    function initUserWelcome() {
      const params = new URLSearchParams(window.location.search);
      const username = params.get('username') || 'Guest';
      document.getElementById('welcomeText').textContent = `Welcome back, ${username} — Today’s goal: Master loops!`;
    }

    function initSidebarToggle() {
      document.getElementById('toggleSidebar').onclick = () => {
        document.querySelector('.sidebar').classList.toggle('open');
        document.getElementById('mainContent').classList.toggle('shifted');
      };
    }

    function initProfileDropdown() {
      const toggle = document.getElementById('profileToggle');
      const dropdown = document.getElementById('profileDropdown');
      const settings = document.getElementById('sidebarSettings');
      toggle.onclick = settings.onclick = () => dropdown.classList.toggle('dropdown-visible');
      document.addEventListener('click', e => {
        if (!toggle.contains(e.target) && !dropdown.contains(e.target) && !settings.contains(e.target)) {
          dropdown.classList.remove('dropdown-visible');
        }
      });
    }

    function initLogout() {
      document.getElementById('logoutLink').onclick = e => {
        e.preventDefault();
        localStorage.clear();
        window.location.href = '../index.html';
      };
    }

    window.addEventListener('load', () => {
      lucide.createIcons();
      initProgressRings();
      initTaskChart();
      initUserWelcome();
      initSidebarToggle();
      initProfileDropdown();
      initLogout();
      createParticles();
    });
  </script>
</body>
</html>